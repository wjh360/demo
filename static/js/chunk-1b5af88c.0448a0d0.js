(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b5af88c"],{"0439":function(e,t,n){},6418:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"roleBox",staticStyle:{margin:"10px"}},[n("el-card",[n("div",{staticClass:"details_header",attrs:{slot:"header"},slot:"header"},[n("i",[e._v("|")]),e._v(" 基本信息 ")]),n("div",[n("el-form",{ref:"form",attrs:{model:e.form,rules:e.isDetails?{}:e.rules,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"角色名称：",prop:"roleName"}},[e.isDetails?n("div",[e._v(" "+e._s(e.form.roleName)+" ")]):n("el-input",{attrs:{placeholder:"请输入角色名称",maxlength:"20"},model:{value:e.form.roleName,callback:function(t){e.$set(e.form,"roleName",t)},expression:"form.roleName"}})],1),n("el-form-item",{attrs:{label:"角色描述："}},[e.isDetails?n("div",[e._v(" "+e._s(e.form.roleDescr)+" ")]):n("el-input",{attrs:{type:"textarea",autosize:{minRows:4},placeholder:"请输入角色描述",maxlength:"100"},model:{value:e.form.roleDescr,callback:function(t){e.$set(e.form,"roleDescr",t)},expression:"form.roleDescr"}})],1),n("el-form-item",{attrs:{label:"应用公司类型：",prop:"companyTypes"}},[e.isDetails?n("div",e._l(e.seProType,(function(t,r){return e.checkProTypeList.includes(t.id)?n("span",{key:r,staticStyle:{"padding-right":"10px"}},[e._v(e._s(t.typeName))]):e._e()})),0):n("el-checkbox-group",{model:{value:e.checkProTypeList,callback:function(t){e.checkProTypeList=t},expression:"checkProTypeList"}},e._l(e.seProType,(function(t,r){return n("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.typeName))])})),1)],1)],1)],1)]),n("el-card",{staticClass:"pd00 jianbianCard",staticStyle:{"margin-top":"10px"}},[n("div",{staticClass:"details_header",attrs:{slot:"header"},slot:"header"},[n("i",[e._v("|")]),e._v(" 权限设置 ")]),n("div",[e.webMenuList&&e.webMenuList.length?e._l(e.webMenuList,(function(t,r){return e.power[t.menuIden]||e.isAdminEdit?n("el-card",{key:r,staticClass:"proccess pd0 pd00"},[n("div",{staticStyle:{"font-size":"16px","font-weight":"bold"},attrs:{slot:"header"},slot:"header"},[e._v(" "+e._s(t.menuName)+" ")]),n("div",[n("ItemTable",{attrs:{list:t.children}})],1)]):e._e()})):[n("el-empty",{attrs:{description:"暂无数据"}})]],2)]),e.isDetails?e._e():n("div",{staticClass:"post_Btn_Box"},[n("el-button",{attrs:{type:"primary",size:"small",loading:e.loading},on:{click:e.postFn}},[e._v(" 提交 ")])],1)],1)},c=[],i=(n("99af"),n("4160"),n("caad"),n("a15b"),n("d3b7"),n("ac1f"),n("6062"),n("2532"),n("3ca3"),n("1276"),n("159b"),n("ddb0"),n("2909")),o=(n("96cf"),n("1da1")),s={roleName:[{required:!0,message:"请输入角色名称",trigger:"submit"}],companyTypes:[{required:!0,message:"请选择应用公司类型",trigger:"submit"}]},a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"AuthorizedTable"},[n("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:e.list,"show-header":!1}},[n("el-table-column",{attrs:{width:"150px",align:"center",label:"一级权限"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-checkbox",{staticStyle:{padding:"5px 10px"},attrs:{indeterminate:!t.row.check&&t.row.miniCheckList.length},on:{change:function(n){return e.checkAll(t.row)}},model:{value:t.row.check,callback:function(n){e.$set(t.row,"check",n)},expression:"scope.row.check"}},[e._v(" "+e._s(t.row.menuName)+" ")])]}}])}),n("el-table-column",{attrs:{prop:"",label:""},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-table",{staticClass:"asds",attrs:{data:t.row.children,"show-header":!1}},[n("el-table-column",{attrs:{prop:"",label:"二级权限",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(r){return[n("el-checkbox",{staticStyle:{padding:"5px 10px"},attrs:{indeterminate:!r.row.check&&r.row.checkList.length},on:{change:function(n){return e.checkinLine(t.row,r.row)}},model:{value:r.row.check,callback:function(t){e.$set(r.row,"check",t)},expression:"bc.row.check"}},[e._v(" "+e._s(r.row.menuName)+" ")])]}}],null,!0)}),n("el-table-column",{attrs:{prop:"",label:"三级权限"},scopedSlots:e._u([{key:"default",fn:function(r){return[n("div",{staticStyle:{padding:"5px"}},[n("el-checkbox-group",{on:{change:function(n){return e.changeItem(t.row,r.row)}},model:{value:r.row.checkList,callback:function(t){e.$set(r.row,"checkList",t)},expression:"cc.row.checkList"}},[e._l(r.row.children,(function(t){return[n("el-checkbox",{key:t.id,staticClass:"min_check",attrs:{label:t.id},model:{value:t.check,callback:function(n){e.$set(t,"check",n)},expression:"fourItem.check"}},[e._v(" "+e._s(t.menuName)+" ")])]}))],2)],1)]}}],null,!0)})],1)]}}])})],1)],1)},l=[],u=(n("c975"),n("d81d"),n("a434"),{props:{list:{type:Array,default:function(){return[]}}},methods:{checkAll:function(e){e.children.forEach((function(t){t.check=e.check,e.check?(e.checkList.push(t.id),t.checkList=t.children.map((function(e){return e.id}))):t.checkList=[]})),e.check||(e.checkList=[]),e.miniCheckList=JSON.parse(JSON.stringify(e.checkList)),this.$forceUpdate()},checkinLine:function(e,t){t.checkList=t.check?t.children.map((function(e){return e.id})):[],this.setCheckItem(e,t),this.$forceUpdate()},changeItem:function(e,t){t.check=t.checkList.length>=t.children.length,this.setCheckItem(e,t),this.$forceUpdate()},setCheckItem:function(e,t){var n=e.checkList.indexOf(t.id),r=e.miniCheckList.indexOf(t.id),c=t.checkList.length;(c||t.check)&&r<0?e.miniCheckList.push(t.id):r>=0&&!c&&e.miniCheckList.splice(r,1),t.check&&n<0?e.checkList.push(t.id):n>=0&&!t.check&&e.checkList.splice(n,1),e.check=e.checkList.length>=e.children.length}}}),d=u,h=(n("7c12"),n("2877")),m=Object(h["a"])(d,a,l,!1,null,null,null),p=m.exports,f=n("b73f"),k=n("cc5e"),b={props:{type:{type:String},isDetails:null},components:{ItemTable:p},data:function(){return{rules:s,form:{roleName:"",roleDescr:"",menuIds:""},webMenuList:[],loading:!1,curClickMenuLevel:null,postDataList:null,echoDataListObj:{},postDataErrMsg:!1,minsetIdx:0,power:this.$store.state.user.power||{},companyProjectList:[],projectId:"",echoProjectId:[],isAdminEdit:!0,checkProTypeList:[],seProType:[],menuIds:[]}},created:function(){this.$route.params.id&&(this.form.id=this.$route.params.id),this.selectCompanyTypeListFn(),this.loadData()},watch:{},methods:{selectCompanyTypeListFn:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(f["g"])();case 2:n=t.sent,r=n.data,r.forEach((function(e){e.id=String(e.id)})),e.seProType=r||[];case 6:case"end":return t.stop()}}),t)})))()},changePostList:function(e,t){this.postDataErrMsg=!1,this.postDataList=this.loopPostList(e),this.$set(this.form,"dataAuthority",t||null),log("数据权限修改","detail")},loopPostList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.forEach((function(t){if(3==t.menuLevel&&t.isShow){var r=[];t.children.forEach((function(e){e.checkData&&r.push(e.id)})),r.length||(e.postDataErrMsg=!0),n.push({rootId:t.rootId,onelmId:t.onelmId,twolmId:t.twolmId,threelmId:t.threelmId,istabPage:1,postId:r.join(),id:t.echoId||null})}else if(t.children&&t.children.length)return e.loopPostList(t.children,n)})),n},loadData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r,c,i,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.form.id){t.next=6;break}return t.next=3,Object(f["a"])({roleId:e.form.id});case 3:t.t0=t.sent,t.next=9;break;case 6:return t.next=8,Object(k["c"])();case 8:t.t0=t.sent;case 9:n=t.t0,r=n.data,e.curClickMenuLevel=3,c=r.webMenuList,e.loopEchoAll(c),i=[{menuName:"电脑端",menuTerminal:1,children:[]},{menuName:"手机端",menuTerminal:2,children:[]}],c.forEach((function(e){1==e.menuTerminal?i[0].children.push(e):i[1].children.push(e)})),e.webMenuList=i,e.form.id&&(e.form.roleName=r.role.roleName,e.form.roleDescr=r.role.roleDescr,e.form.companyId=r.role.companyId,e.checkProTypeList=r.role.companyTypes?r.role.companyTypes.split(","):[],o=r.dataPermissions||[],s={},o.forEach((function(e){s[e.threelmId]=e})),s.dataAuthority=r.role.dataAuthority||null,e.echoDataListObj=s),console.log(e.webMenuList);case 19:case"end":return t.stop()}}),t)})))()},loopEchoAll:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.forEach((function(t){if(t.checkList=[],t.miniCheckList=[],t.pitchOn>=1?(t.check=!0,n.push(t.id)):t.check=!1,t.children&&t.children.length)return e.loopEchoAll(t.children,t.checkList)}))},twoChange:function(e){var t=this;!e.check&&e.children&&e.children.length?e.children.forEach((function(e){e.check=!1,t.twoChange(e)})):e.check=e.check||!1,this.$forceUpdate(),this.$set(this.webMenuList[0],"minsetIdx",Math.random())},allin:function(e,t){var n=this;this.minsetIdx++,e.check=!0,t&&(t.check=!0),e.children&&e.children.length&&e.children.forEach((function(e){n.allin(e)})),this.$forceUpdate(),this.curClickMenuLevel=3,this.$set(this.webMenuList[0],"minsetIdx",Math.random())},cancelAllIn:function(e){var t=this;e.check=!1,e.children&&e.children.length&&e.children.forEach((function(e){t.cancelAllIn(e)})),this.$forceUpdate(),this.$set(this.webMenuList[0],"minsetIdx",Math.random())},checkChange:function(e,t,n){n.check&&(e.check=!0,t.check=!0),this.curClickMenuLevel=n.menuLevel,this.$forceUpdate()},loopAll:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach((function(t){e.menuIds=e.menuIds.concat(t.checkList||[]),t.checkList&&t.checkList.length&&t.id&&(e.menuIds.includes(t.id)||e.menuIds.push(t.id),!e.menuIds.includes(t.fatherId)&&t.fatherId&&e.menuIds.push(t.fatherId)),t.children&&t.children.length&&e.loopAll(t.children||[])})),this.menuIds=Object(i["a"])(new Set(this.menuIds))},postFn:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.menuIds=[],e.loopAll(JSON.parse(JSON.stringify(e.webMenuList))),log(e.menuIds),log(e.webMenuList),t.abrupt("return");case 7:case"end":return t.stop()}}),t)})))()}}},g=b,y=(n("e4ce"),Object(h["a"])(g,r,c,!1,null,null,null));t["a"]=y.exports},"7c12":function(e,t,n){"use strict";n("0439")},"9a02":function(e,t,n){},b775:function(e,t,n){"use strict";n("caad"),n("d3b7"),n("2532");var r=n("bc3a"),c=n.n(r),i=n("5c96"),o=n("4360"),s=n("4328"),a=n.n(s),l=n("e350"),u=c.a.create({baseURL:"https://bj.xiaoyihuanbao.com",timeout:6e5});function d(e,t){Object(i["Message"])({message:e,type:t,duration:5e3})}u.interceptors.request.use((function(e){var t=window.localStorage.getItem("user_id"),n=window.localStorage.getItem("token");n&&(e.headers["token"]=n,e.headers["userId"]=t,e.headers["user_id"]=t,e.headers["companyId"]=o["a"].getters.companyId);var r=Object(l["a"])(e);return"GET"!==e.method&&e.data&&(e.data.postId=r,e.data.userId=e.data.userId||t,e.data=a.a.stringify(e.data)),e}),(function(e){return console.error("Request error:",e),Promise.reject(e)})),u.interceptors.response.use((function(e){var t=e.data;return 200!==e.status||0!==t.ret_code?(d(t.error_msg||t.message||"Error","error"),Promise.reject(new Error(t.message||"Error"))):t}),(function(e){if(console.error("Response error:",e),"ECONNABORTED"===e.code&&e.message.includes("timeout")){var t=e.config;return t.__retryCount>=t.retry?Promise.reject(e):(t.__retryCount=(t.__retryCount||0)+1,new Promise((function(e){return setTimeout(e,t.retryDelay||1)})).then((function(){return u(t)})))}if(e.response)switch(e.response.status){case 401:i["MessageBox"].confirm("您的登录状态异常，您可以留在此页面，也可以重新登录！","状态异常",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then((function(){o["a"].dispatch("user/resetToken").then((function(){location.reload()}))}));break}return d(e.response?e.response.data.message:e.message,"error"),{}})),t["a"]=u},cc5e:function(e,t,n){"use strict";n.d(t,"h",(function(){return c})),n.d(t,"b",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"j",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"f",(function(){return l})),n.d(t,"i",(function(){return u})),n.d(t,"g",(function(){return d})),n.d(t,"d",(function(){return h})),n.d(t,"c",(function(){return m}));var r=n("b775");function c(){return Object(r["a"])({qs:!0,url:"/zymp/config/getAllRoute",method:"GET"})}function i(e){return Object(r["a"])({qs:!0,url:"/zymp/config/addRoute",method:"PUT",data:e})}function o(e){return Object(r["a"])({qs:!0,url:"/zymp/config/delRoute",method:"DELETE",data:{id:e}})}function s(e){return Object(r["a"])({qs:!0,url:"/zymp/config/updateRoute",method:"POST",data:e})}function a(e){return Object(r["a"])({qs:!0,url:"/authority/menu/addMenu",method:"POST",data:e})}function l(e){return Object(r["a"])({qs:!0,url:"/authority/menu/doUpdate",method:"POST",data:e})}function u(e){return Object(r["a"])({qs:!0,url:"/authority/menu/listMenuByPage",method:"GET",params:e})}function d(e){return Object(r["a"])({qs:!0,url:"/authority/menu/enableOrDisable",method:"POST",data:e})}function h(e){return Object(r["a"])({qs:!0,url:"/authority/menu/deleteMenuById",method:"POST",data:e})}function m(e){return Object(r["a"])({qs:!0,url:"/authority/role/beforeAddRole",method:"POST",data:e})}},e4ce:function(e,t,n){"use strict";n("9a02")}}]);